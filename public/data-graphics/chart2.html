<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chart 02 ‚Äî Multi-Series Comparison Line</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #0D0D0E; font-family: 'Inter', -apple-system, sans-serif; padding: 24px; }
    .header { margin-bottom: 16px; }
    .tag { display: inline-block; background: #22BF4A; color: white; font-size: 11px; font-weight: 600; padding: 3px 8px; border-radius: 3px; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
    .title { font-size: 18px; font-weight: 500; color: #D9D9E0; margin-bottom: 4px; }
    .desc { font-size: 13px; color: #999AA6; }
    .sim-bar { display: flex; align-items: center; gap: 10px; margin: 14px 0 10px; padding: 10px 14px; background: rgba(59,130,245,0.08); border: 1px solid rgba(59,130,245,0.25); border-radius: 6px; }
    .btn { border: none; padding: 6px 14px; border-radius: 4px; font-size: 13px; font-weight: 500; cursor: pointer; font-family: inherit; }
    .btn-start { background: #3B82F5; color: white; }
    .btn-pause { background: #F28500; color: white; }
    .btn-reset { background: #4b5563; color: white; }
    .btn:disabled { opacity: 0.4; cursor: not-allowed; }
    .status { color: #999AA6; font-size: 12px; display: flex; align-items: center; gap: 6px; }
    .status.live { color: #22BF4A; }
    .pulse { width: 7px; height: 7px; background: #22BF4A; border-radius: 50%; animation: pulse 2s infinite; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }
    .alert { margin-top: 10px; padding: 8px 12px; background: rgba(204,61,61,0.15); border: 1px solid rgba(204,61,61,0.4); border-radius: 4px; color: #CC3D3D; font-size: 12px; display: none; }
    .alert.show { display: block; }
  </style>
</head>
<body>
  <div class="header">
    <span class="tag">Chart 02</span>
    <div class="title">Multi-Series Comparison Line</div>
    <div class="desc">Compare 2‚Äì5 related metrics simultaneously. Environment comparison, regional metrics, service health.</div>
  </div>
  <div class="sim-bar">
    <button class="btn btn-start" id="s1" onclick="start()">‚ñ∂ Simulate Traffic Spike</button>
    <button class="btn btn-pause" id="p1" onclick="pause()" disabled>‚è∏ Pause</button>
    <button class="btn btn-reset" id="r1" onclick="reset()">‚Ü∫ Reset</button>
    <div class="status" id="st1">Ready to simulate</div>
  </div>
  <div class="alert" id="al1"></div>
  <div id="vis"></div>

  <script>
    const spec = {
      "$schema": "https://vega.github.io/schema/vega/v5.json",
      "width": "container", "height": 280,
      "padding": {"top": 10, "left": 60, "right": 20, "bottom": 50},
      "background": "#171719",
      "autosize": {"type": "fit", "contains": "padding"},
      "data": [{ "name": "table", "values": [
        {"week":"Week 1","Production":1245,"Staging":892,"Development":445},
        {"week":"Week 2","Production":1389,"Staging":945,"Development":478},
        {"week":"Week 3","Production":1502,"Staging":1023,"Development":512},
        {"week":"Week 4","Production":1456,"Staging":998,"Development":489}
      ], "transform": [{"type":"fold","fields":["Production","Staging","Development"],"as":["series","value"]}]}],
      "scales": [
        {"name":"x","type":"point","domain":{"data":"table","field":"week"},"range":"width","padding":0.5},
        {"name":"y","type":"linear","domain":{"data":"table","field":"value"},"range":"height","nice":true,"zero":true},
        {"name":"color","type":"ordinal","domain":["Production","Staging","Development"],"range":["#3B82F5","#22BF4A","#F2CB05"]}
      ],
      "axes": [
        {"orient":"bottom","scale":"x","labelColor":"#999AA6","labelFontSize":11,"labelFont":"Inter,sans-serif","labelPadding":8,"tickColor":"#4D4E56","tickSize":5,"domain":false,"grid":false,"title":null},
        {"orient":"left","scale":"y","labelColor":"#999AA6","labelFontSize":11,"labelFont":"Inter,sans-serif","labelPadding":8,"tickColor":"#4D4E56","tickSize":5,"tickCount":5,"domain":false,"grid":true,"gridColor":"#4D4E56","gridOpacity":0.4,"title":null}
      ],
      "marks": [{"type":"group","from":{"facet":{"name":"series","data":"table","groupby":"series"}},"marks":[
        {"type":"line","from":{"data":"series"},"encode":{"enter":{"x":{"scale":"x","field":"week"},"y":{"scale":"y","field":"value"},"stroke":{"scale":"color","field":"series"},"strokeWidth":{"value":2}}}},
        {"type":"symbol","from":{"data":"series"},"encode":{"enter":{"x":{"scale":"x","field":"week"},"y":{"scale":"y","field":"value"},"fill":{"scale":"color","field":"series"},"size":{"value":50},"stroke":{"value":"#171719"},"strokeWidth":{"value":2}}}}
      ]}],
      "legends": [{"stroke":"color","title":null,"orient":"bottom","direction":"horizontal","symbolType":"stroke","symbolStrokeWidth":2,"symbolOffset":8,"labelColor":"#D9D9E0","labelFont":"Inter,sans-serif","labelFontSize":11,"labelOffset":8,"offset":20,"padding":10}]
    };

    vegaEmbed('#vis', spec, {actions:false});

    let data = spec.data[0].values.map(d=>({...d}));
    const init = JSON.parse(JSON.stringify(data));
    let interval, iter = 0;

    function start() {
      iter = 0;
      document.getElementById('s1').disabled = true;
      document.getElementById('p1').disabled = false;
      setStatus('Simulating traffic spike...', true);
      interval = setInterval(() => {
        iter++;
        data = data.map(r => ({...r,
          Production: Math.min(4000, r.Production + Math.random()*150+100),
          Staging: Math.min(2500, r.Staging + Math.random()*80+50),
          Development: Math.min(1200, r.Development + Math.random()*40+20)
        }));
        spec.data[0].values = data;
        vegaEmbed('#vis', spec, {actions:false});
        if (data[data.length-1].Production > 3000) showAlert('üî• Production spike: ' + Math.round(data[data.length-1].Production) + ' req/sec');
        if (iter >= 8) { pause(); setStatus('Spike simulation complete'); }
      }, 800);
    }
    function pause() {
      clearInterval(interval);
      document.getElementById('s1').disabled = false;
      document.getElementById('p1').disabled = true;
      setStatus('Paused');
    }
    function reset() {
      clearInterval(interval);
      data = JSON.parse(JSON.stringify(init));
      spec.data[0].values = data;
      vegaEmbed('#vis', spec, {actions:false});
      document.getElementById('s1').disabled = false;
      document.getElementById('p1').disabled = true;
      setStatus('Ready to simulate');
      document.getElementById('al1').className = 'alert';
    }
    function setStatus(msg, live=false) {
      const el = document.getElementById('st1');
      el.className = live ? 'status live' : 'status';
      el.innerHTML = live ? `<span class="pulse"></span>${msg}` : msg;
    }
    function showAlert(msg) {
      const el = document.getElementById('al1');
      el.textContent = msg; el.className = 'alert show';
      setTimeout(() => el.className = 'alert', 5000);
    }
  </script>
</body>
</html>
