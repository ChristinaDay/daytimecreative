<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Operational Data Graphics | Full Demo</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    /* Theme Variables */
    :root {
      /* Light Mode (default) */
      --bg-canvas: #ffffff;
      --bg-chart: #f9fafb;
      --bg-elevated: #f3f4f6;
      --text-primary: #1a1a1a;
      --text-secondary: #6b7280;
      --text-muted: #9ca3af;
      --border-default: #e5e7eb;
      --border-grid: #d1d5db;
      --shadow: rgba(0, 0, 0, 0.1);
    }
    
    :root[data-theme="dark"] {
      /* Dark Mode */
      --bg-canvas: #0D0D0E;
      --bg-chart: #171719;
      --bg-elevated: #2a2a2a;
      --text-primary: #D9D9E0;
      --text-secondary: #999AA6;
      --text-muted: #6b7280;
      --border-default: #33353A;
      --border-grid: #4D4E56;
      --shadow: rgba(0, 0, 0, 0.5);
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg-canvas);
      color: var(--text-primary);
      line-height: 1.6;
      transition: background 0.3s ease, color 0.3s ease;
    }
    
    /* Sticky Navigation */
    nav {
      position: sticky;
      top: 0;
      background: var(--bg-canvas);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border-default);
      padding: 1rem 2rem;
      z-index: 100;
      transition: background 0.3s ease, border-color 0.3s ease;
    }
    
    nav .container {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    nav h1 {
      font-size: 1.125rem;
      font-weight: 500;
      color: var(--text-primary);
    }
    
    nav .links {
      display: flex;
      gap: 1.5rem;
      align-items: center;
    }
    
    nav a {
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 0.875rem;
      transition: color 0.2s;
    }
    
    nav a:hover {
      color: #3B82F5;
    }
    
    nav a.active {
      color: #3B82F5;
    }
    
    /* Theme Toggle */
    .theme-toggle {
      background: var(--bg-elevated);
      border: 1px solid var(--border-default);
      border-radius: 20px;
      padding: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: all 0.3s ease;
    }
    
    .theme-toggle:hover {
      border-color: #3B82F5;
    }
    
    .theme-option {
      padding: 4px 12px;
      border-radius: 14px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .theme-option.active {
      background: #3B82F5;
      color: white;
    }
    
    /* Main Content */
    main {
      max-width: 1400px;
      margin: 0 auto;
      padding: 3rem 2rem;
    }
    
    .hero {
      margin-bottom: 4rem;
      padding-bottom: 3rem;
      border-bottom: 1px solid var(--border-default);
    }
    
    .hero h2 {
      font-size: 2.5rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--text-primary);
    }
    
    .hero p {
      font-size: 1.125rem;
      color: var(--text-secondary);
      max-width: 700px;
      line-height: 1.7;
    }
    
    /* Chart Sections */
    .chart-section {
      margin-bottom: 5rem;
      scroll-margin-top: 80px;
    }
    
    .chart-header {
      margin-bottom: 2rem;
    }
    
    .chart-number {
      display: inline-block;
      background: #22BF4A;
      color: white;
      font-size: 0.75rem;
      font-weight: 600;
      padding: 4px 10px;
      border-radius: 4px;
      margin-bottom: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .chart-header h3 {
      font-size: 1.75rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }
    
    .chart-header p {
      color: var(--text-secondary);
      font-size: 0.95rem;
    }
    
    .chart-container {
      background: var(--bg-chart);
      border: 1px solid var(--border-default);
      border-radius: 8px;
      padding: 2rem;
      transition: background 0.3s ease, border-color 0.3s ease;
    }
    
    /* Simulation Controls */
    .simulation-controls {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
      padding: 12px 16px;
      background: rgba(59, 130, 245, 0.1);
      border: 1px solid rgba(59, 130, 245, 0.3);
      border-radius: 6px;
    }
    
    .sim-button {
      background: #3B82F5;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
      font-family: 'Inter', sans-serif;
    }
    
    .sim-button:hover {
      background: #2563eb;
    }
    
    .sim-button:disabled {
      background: #4D4E56;
      cursor: not-allowed;
      opacity: 0.5;
    }
    
    .sim-button.pause {
      background: #F28500;
    }
    
    .sim-button.pause:hover {
      background: #d97706;
    }
    
    .sim-button.reset {
      background: #6b7280;
    }
    
    .sim-button.reset:hover {
      background: #4b5563;
    }
    
    .sim-status {
      color: var(--text-secondary);
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .sim-status.active {
      color: #22BF4A;
    }
    
    .sim-status .pulse {
      width: 8px;
      height: 8px;
      background: #22BF4A;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
    
    .alert-message {
      padding: 10px 14px;
      background: rgba(204, 61, 61, 0.15);
      border: 1px solid rgba(204, 61, 61, 0.4);
      border-radius: 4px;
      color: #CC3D3D;
      font-size: 13px;
      margin-top: 12px;
      display: none;
    }
    
    .alert-message.show {
      display: block;
      animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Footer */
    footer {
      max-width: 1400px;
      margin: 0 auto;
      padding: 3rem 2rem;
      border-top: 1px solid var(--border-default);
      text-align: center;
      color: var(--text-secondary);
      font-size: 0.875rem;
    }
    
    footer a {
      color: #3B82F5;
      text-decoration: none;
    }
    
    footer a:hover {
      text-decoration: underline;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      nav .links {
        gap: 1rem;
        flex-wrap: wrap;
      }
      
      .hero h2 {
        font-size: 1.75rem;
      }
      
      .chart-header h3 {
        font-size: 1.25rem;
      }
      
      .chart-container {
        padding: 1rem;
        overflow-x: auto;
      }
    }
  </style>
</head>
<body>
  <nav>
    <div class="container">
      <h1>Operational Data Graphics</h1>
      <div class="links">
        <a href="#chart1">Time-Series</a>
        <a href="#chart2">Multi-Series</a>
        <a href="#chart4">Histogram</a>
        <a href="#chart6">Status Timeline</a>
        <div class="theme-toggle">
          <div class="theme-option active" onclick="setTheme('light')" id="theme-light">‚òÄÔ∏è Light</div>
          <div class="theme-option" onclick="setTheme('dark')" id="theme-dark">üåô Dark</div>
        </div>
        <a href="index.html">‚Üê All Charts</a>
      </div>
    </div>
  </nav>

  <main>
    <div class="hero">
      <h2>Full Chart Demo</h2>
      <p>
        High-signal, low-noise data graphics designed for operational monitoring. 
        Built with full Vega to demonstrate systems-level design thinking and implementation credibility.
      </p>
      <p style="margin-top: 16px; color: #3B82F5; font-weight: 500;">
        ‚ñ∂ Interactive: Click "Simulate" buttons to see how charts handle real-time operational data updates
      </p>
    </div>

    <!-- Chart 1 -->
    <section id="chart1" class="chart-section">
      <div class="chart-header">
        <span class="chart-number">Chart 01</span>
        <h3>High-Density Time-Series Line Chart</h3>
        <p>Continuous metric trends over time with minimal visual noise. Perfect for CPU, memory, and latency monitoring.</p>
      </div>
      <div class="chart-container">
        <div class="simulation-controls">
          <button class="sim-button" onclick="startSimulation1()" id="start-btn-1">‚ñ∂ Simulate Live Updates</button>
          <button class="sim-button pause" onclick="pauseSimulation1()" id="pause-btn-1" disabled>‚è∏ Pause</button>
          <button class="sim-button reset" onclick="resetSimulation1()" id="reset-btn-1">‚Ü∫ Reset</button>
          <div class="sim-status" id="status-1">
            Ready to simulate real-time metrics
          </div>
        </div>
        <div class="alert-message" id="alert-1"></div>
        <div id="vis1"></div>
      </div>
    </section>

    <!-- Chart 2 -->
    <section id="chart2" class="chart-section">
      <div class="chart-header">
        <span class="chart-number">Chart 02</span>
        <h3>Multi-Series Comparison Line Chart</h3>
        <p>Compare 2-5 related metrics simultaneously. Ideal for environment comparison, regional metrics, and service health.</p>
      </div>
      <div class="chart-container">
        <div class="simulation-controls">
          <button class="sim-button" onclick="startSimulation2()" id="start-btn-2">‚ñ∂ Simulate Traffic Spike</button>
          <button class="sim-button pause" onclick="pauseSimulation2()" id="pause-btn-2" disabled>‚è∏ Pause</button>
          <button class="sim-button reset" onclick="resetSimulation2()" id="reset-btn-2">‚Ü∫ Reset</button>
          <div class="sim-status" id="status-2">
            Ready to simulate traffic patterns
          </div>
        </div>
        <div class="alert-message" id="alert-2"></div>
        <div id="vis2"></div>
      </div>
    </section>

    <!-- Chart 4 -->
    <section id="chart4" class="chart-section">
      <div class="chart-header">
        <span class="chart-number">Chart 04</span>
        <h3>Histogram / Distribution</h3>
        <p>Frequency distribution of continuous variables. Shows latency percentiles, request sizes, and error patterns.</p>
      </div>
      <div class="chart-container">
        <div class="simulation-controls">
          <button class="sim-button" onclick="startSimulation4()" id="start-btn-4">‚ñ∂ Simulate Degradation</button>
          <button class="sim-button pause" onclick="pauseSimulation4()" id="pause-btn-4" disabled>‚è∏ Pause</button>
          <button class="sim-button reset" onclick="resetSimulation4()" id="reset-btn-4">‚Ü∫ Reset</button>
          <div class="sim-status" id="status-4">
            Ready to simulate performance degradation
          </div>
        </div>
        <div class="alert-message" id="alert-4"></div>
        <div id="vis4"></div>
      </div>
    </section>

    <!-- Chart 6 -->
    <section id="chart6" class="chart-section">
      <div class="chart-header">
        <span class="chart-number">Chart 06</span>
        <h3>Status Timeline (Health Bands)</h3>
        <p>System health states over time. Visualizes service uptime, incident timelines, and deployment status.</p>
      </div>
      <div class="chart-container">
        <div class="simulation-controls">
          <button class="sim-button" onclick="startSimulation6()" id="start-btn-6">‚ñ∂ Simulate Incident</button>
          <button class="sim-button pause" onclick="pauseSimulation6()" id="pause-btn-6" disabled>‚è∏ Pause</button>
          <button class="sim-button reset" onclick="resetSimulation6()" id="reset-btn-6">‚Ü∫ Reset</button>
          <div class="sim-status" id="status-6">
            Ready to simulate service incident
          </div>
        </div>
        <div class="alert-message" id="alert-6"></div>
        <div id="vis6"></div>
      </div>
    </section>
  </main>

  <footer>
    <p>
      Built with <a href="https://vega.github.io/vega/" target="_blank">Vega</a> ‚Ä¢ 
      <a href="index.html">View Chart Index</a> ‚Ä¢ 
      <a href="../README.md">Documentation</a>
    </p>
  </footer>

  <script>
    // Chart 1: High-Density Time-Series Line Chart
    const spec1 = {
      "$schema": "https://vega.github.io/schema/vega/v5.json",
      "description": "High-density time-series line chart for operational metrics",
      "width": 1000,
      "height": 300,
      "padding": {"top": 10, "left": 60, "right": 20, "bottom": 40},
      "background": "#171719",
      
      "data": [
        {
          "name": "table",
          "values": [
            {"time": "00:00", "value": 45.2, "series": "Production"},
            {"time": "02:00", "value": 48.1, "series": "Production"},
            {"time": "04:00", "value": 52.3, "series": "Production"},
            {"time": "06:00", "value": 68.5, "series": "Production"},
            {"time": "08:00", "value": 82.4, "series": "Production"},
            {"time": "10:00", "value": 78.9, "series": "Production"},
            {"time": "12:00", "value": 85.2, "series": "Production"},
            {"time": "14:00", "value": 79.8, "series": "Production"},
            {"time": "16:00", "value": 72.4, "series": "Production"},
            {"time": "18:00", "value": 65.1, "series": "Production"},
            {"time": "20:00", "value": 58.3, "series": "Production"},
            {"time": "22:00", "value": 51.2, "series": "Production"},
            {"time": "24:00", "value": 46.8, "series": "Production"}
          ]
        }
      ],
      
      "scales": [
        {
          "name": "x",
          "type": "point",
          "domain": {"data": "table", "field": "time"},
          "range": "width",
          "padding": 0.5
        },
        {
          "name": "y",
          "type": "linear",
          "domain": [0, 100],
          "range": "height",
          "nice": true,
          "zero": true
        }
      ],
      
      "axes": [
        {
          "orient": "bottom",
          "scale": "x",
          "labelColor": "#999AA6",
          "labelFontSize": 11,
          "labelFont": "Inter, sans-serif",
          "labelPadding": 8,
          "tickColor": "#4D4E56",
          "tickSize": 5,
          "domain": false,
          "grid": false,
          "title": null
        },
        {
          "orient": "left",
          "scale": "y",
          "labelColor": "#999AA6",
          "labelFontSize": 11,
          "labelFont": "Inter, sans-serif",
          "labelPadding": 8,
          "tickColor": "#4D4E56",
          "tickSize": 5,
          "tickCount": 5,
          "domain": false,
          "grid": true,
          "gridColor": "#4D4E56",
          "gridOpacity": 0.4,
          "title": null
        }
      ],
      
      "marks": [
        {
          "type": "line",
          "from": {"data": "table"},
          "encode": {
            "enter": {
              "x": {"scale": "x", "field": "time"},
              "y": {"scale": "y", "field": "value"},
              "stroke": {"value": "#3B82F5"},
              "strokeWidth": {"value": 2}
            }
          }
        },
        {
          "type": "symbol",
          "from": {"data": "table"},
          "encode": {
            "enter": {
              "x": {"scale": "x", "field": "time"},
              "y": {"scale": "y", "field": "value"},
              "fill": {"value": "#3B82F5"},
              "size": {"value": 50},
              "stroke": {"value": "#171719"},
              "strokeWidth": {"value": 2}
            },
            "update": {
              "fillOpacity": {"value": 1}
            },
            "hover": {
              "fillOpacity": {"value": 0.7}
            }
          }
        }
      ]
    };

    // Chart 2: Multi-Series Comparison Line Chart
    const spec2 = {
      "$schema": "https://vega.github.io/schema/vega/v5.json",
      "description": "Multi-series comparison line chart",
      "width": 1000,
      "height": 350,
      "padding": {"top": 10, "left": 60, "right": 20, "bottom": 40},
      "background": "#171719",
      
      "data": [
        {
          "name": "table",
          "values": [
            {"week": "Week 1", "Production": 1245, "Staging": 892, "Development": 445},
            {"week": "Week 2", "Production": 1389, "Staging": 945, "Development": 478},
            {"week": "Week 3", "Production": 1502, "Staging": 1023, "Development": 512},
            {"week": "Week 4", "Production": 1456, "Staging": 998, "Development": 489}
          ],
          "transform": [
            {
              "type": "fold",
              "fields": ["Production", "Staging", "Development"],
              "as": ["series", "value"]
            }
          ]
        }
      ],
      
      "scales": [
        {
          "name": "x",
          "type": "point",
          "domain": {"data": "table", "field": "week"},
          "range": "width",
          "padding": 0.5
        },
        {
          "name": "y",
          "type": "linear",
          "domain": {"data": "table", "field": "value"},
          "range": "height",
          "nice": true,
          "zero": true
        },
        {
          "name": "color",
          "type": "ordinal",
          "domain": ["Production", "Staging", "Development"],
          "range": ["#3B82F5", "#22BF4A", "#F2CB05"]
        }
      ],
      
      "axes": [
        {
          "orient": "bottom",
          "scale": "x",
          "labelColor": "#999AA6",
          "labelFontSize": 11,
          "labelFont": "Inter, sans-serif",
          "labelPadding": 8,
          "tickColor": "#4D4E56",
          "tickSize": 5,
          "domain": false,
          "grid": false,
          "title": null
        },
        {
          "orient": "left",
          "scale": "y",
          "labelColor": "#999AA6",
          "labelFontSize": 11,
          "labelFont": "Inter, sans-serif",
          "labelPadding": 8,
          "tickColor": "#4D4E56",
          "tickSize": 5,
          "tickCount": 5,
          "domain": false,
          "grid": true,
          "gridColor": "#4D4E56",
          "gridOpacity": 0.4,
          "title": null
        }
      ],
      
      "marks": [
        {
          "type": "group",
          "from": {
            "facet": {
              "name": "series",
              "data": "table",
              "groupby": "series"
            }
          },
          "marks": [
            {
              "type": "line",
              "from": {"data": "series"},
              "encode": {
                "enter": {
                  "x": {"scale": "x", "field": "week"},
                  "y": {"scale": "y", "field": "value"},
                  "stroke": {"scale": "color", "field": "series"},
                  "strokeWidth": {"value": 2}
                }
              }
            },
            {
              "type": "symbol",
              "from": {"data": "series"},
              "encode": {
                "enter": {
                  "x": {"scale": "x", "field": "week"},
                  "y": {"scale": "y", "field": "value"},
                  "fill": {"scale": "color", "field": "series"},
                  "size": {"value": 50},
                  "stroke": {"value": "#171719"},
                  "strokeWidth": {"value": 2}
                }
              }
            }
          ]
        }
      ],
      
      "legends": [
        {
          "stroke": "color",
          "title": null,
          "orient": "bottom",
          "direction": "horizontal",
          "symbolType": "stroke",
          "symbolStrokeWidth": 2,
          "symbolOffset": 8,
          "labelColor": "#D9D9E0",
          "labelFont": "Inter, sans-serif",
          "labelFontSize": 11,
          "labelOffset": 8,
          "offset": 20,
          "padding": 10,
          "encode": {
            "symbols": {
              "update": {
                "strokeWidth": {"value": 2}
              }
            }
          }
        }
      ]
    };

    // Chart 4: Histogram / Distribution
    const spec4 = {
      "$schema": "https://vega.github.io/schema/vega/v5.json",
      "description": "Histogram showing response time distribution",
      "width": 1000,
      "height": 300,
      "padding": {"top": 10, "left": 60, "right": 20, "bottom": 40},
      "background": "#171719",
      
      "data": [
        {
          "name": "table",
          "values": [
            {"bin": "0-50ms", "count": 1240, "binStart": 0, "binEnd": 50},
            {"bin": "50-100ms", "count": 3580, "binStart": 50, "binEnd": 100},
            {"bin": "100-150ms", "count": 2150, "binStart": 100, "binEnd": 150},
            {"bin": "150-200ms", "count": 890, "binStart": 150, "binEnd": 200},
            {"bin": "200+ms", "count": 320, "binStart": 200, "binEnd": 250}
          ]
        }
      ],
      
      "scales": [
        {
          "name": "x",
          "type": "band",
          "domain": {"data": "table", "field": "bin"},
          "range": "width",
          "padding": 0.2
        },
        {
          "name": "y",
          "type": "linear",
          "domain": {"data": "table", "field": "count"},
          "range": "height",
          "nice": true,
          "zero": true
        }
      ],
      
      "axes": [
        {
          "orient": "bottom",
          "scale": "x",
          "labelColor": "#999AA6",
          "labelFontSize": 11,
          "labelFont": "Inter, sans-serif",
          "labelPadding": 8,
          "tickColor": "#4D4E56",
          "tickSize": 5,
          "domain": false,
          "grid": false,
          "title": null
        },
        {
          "orient": "left",
          "scale": "y",
          "labelColor": "#999AA6",
          "labelFontSize": 11,
          "labelFont": "Inter, sans-serif",
          "labelPadding": 8,
          "tickColor": "#4D4E56",
          "tickSize": 5,
          "tickCount": 5,
          "domain": false,
          "grid": true,
          "gridColor": "#4D4E56",
          "gridOpacity": 0.4,
          "title": null,
          "format": "~s"
        }
      ],
      
      "marks": [
        {
          "type": "rect",
          "from": {"data": "table"},
          "encode": {
            "enter": {
              "x": {"scale": "x", "field": "bin"},
              "width": {"scale": "x", "band": 1},
              "y": {"scale": "y", "field": "count"},
              "y2": {"scale": "y", "value": 0},
              "fill": {"value": "#3B82F5"},
              "cornerRadiusTopLeft": {"value": 4},
              "cornerRadiusTopRight": {"value": 4}
            },
            "update": {
              "fillOpacity": {"value": 0.85}
            },
            "hover": {
              "fillOpacity": {"value": 1}
            }
          }
        }
      ]
    };

    // Chart 6: Status Timeline
    const spec6 = {
      "$schema": "https://vega.github.io/schema/vega/v5.json",
      "description": "Status timeline showing system health bands over time",
      "width": 1000,
      "height": 300,
      "padding": {"top": 10, "left": 60, "right": 20, "bottom": 40},
      "background": "#171719",
      
      "data": [
        {
          "name": "table",
          "values": [
            {"service": "Auth Service", "start": 0, "end": 6, "status": "Healthy", "serviceOrder": 0},
            {"service": "Auth Service", "start": 6, "end": 14, "status": "Warning", "serviceOrder": 0},
            {"service": "Auth Service", "start": 14, "end": 24, "status": "Healthy", "serviceOrder": 0},
            {"service": "API Gateway", "start": 0, "end": 10, "status": "Healthy", "serviceOrder": 1},
            {"service": "API Gateway", "start": 10, "end": 24, "status": "Healthy", "serviceOrder": 1},
            {"service": "Database", "start": 0, "end": 6, "status": "Healthy", "serviceOrder": 2},
            {"service": "Database", "start": 6, "end": 10, "status": "Warning", "serviceOrder": 2},
            {"service": "Database", "start": 10, "end": 13, "status": "Error", "serviceOrder": 2},
            {"service": "Database", "start": 13, "end": 24, "status": "Healthy", "serviceOrder": 2}
          ]
        }
      ],
      
      "scales": [
        {
          "name": "x",
          "type": "linear",
          "domain": [0, 24],
          "range": "width",
          "zero": true,
          "nice": false
        },
        {
          "name": "y",
          "type": "band",
          "domain": {"data": "table", "field": "service", "sort": {"field": "serviceOrder"}},
          "range": "height",
          "padding": 0.3
        },
        {
          "name": "color",
          "type": "ordinal",
          "domain": ["Healthy", "Warning", "Error"],
          "range": ["#22BF4A", "#F28500", "#CC3D3D"]
        }
      ],
      
      "axes": [
        {
          "orient": "top",
          "scale": "x",
          "labelColor": "#999AA6",
          "labelFontSize": 11,
          "labelFont": "Inter, sans-serif",
          "labelPadding": 8,
          "tickColor": "#999AA6",
          "tickSize": 5,
          "domain": false,
          "grid": false,
          "title": null,
          "format": "d",
          "values": [0, 6, 12, 18, 24],
          "labelExpr": "datum.value + 'h'"
        },
        {
          "orient": "left",
          "scale": "y",
          "labelColor": "#D9D9E0",
          "labelFontSize": 12,
          "labelFont": "Inter, sans-serif",
          "labelPadding": 8,
          "tickSize": 0,
          "domain": false,
          "grid": false,
          "title": null
        }
      ],
      
      "marks": [
        {
          "type": "rect",
          "from": {"data": "table"},
          "encode": {
            "enter": {
              "x": {"scale": "x", "field": "start"},
              "x2": {"scale": "x", "field": "end"},
              "y": {"scale": "y", "field": "service"},
              "height": {"scale": "y", "band": 1},
              "fill": {"scale": "color", "field": "status"},
              "fillOpacity": {"value": 0.85},
              "cornerRadius": {"value": 3}
            },
            "update": {
              "fillOpacity": {"value": 0.85},
              "stroke": {"value": null}
            },
            "hover": {
              "fillOpacity": {"value": 1},
              "stroke": {"value": "#FFFFFF"},
              "strokeWidth": {"value": 1}
            }
          }
        }
      ],
      
      "legends": [
        {
          "fill": "color",
          "title": null,
          "orient": "bottom",
          "direction": "horizontal",
          "symbolType": "square",
          "symbolSize": 100,
          "symbolOffset": 8,
          "labelColor": "#D9D9E0",
          "labelFont": "Inter, sans-serif",
          "labelFontSize": 11,
          "labelOffset": 8,
          "offset": 10
        }
      ]
    };

    // Embed all charts
    vegaEmbed('#vis1', spec1, { actions: false, tooltip: { theme: 'dark' } });
    vegaEmbed('#vis2', spec2, { actions: false, tooltip: { theme: 'dark' } });
    vegaEmbed('#vis4', spec4, { actions: false, tooltip: { theme: 'dark' } });
    vegaEmbed('#vis6', spec6, { actions: false, tooltip: { theme: 'dark' } });

    // Smooth scroll and active nav link highlighting
    document.querySelectorAll('nav a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    });

    // Highlight active section in nav on scroll
    const sections = document.querySelectorAll('.chart-section');
    const navLinks = document.querySelectorAll('nav a[href^="#"]');

    window.addEventListener('scroll', () => {
      let current = '';
      sections.forEach(section => {
        const sectionTop = section.offsetTop;
        const sectionHeight = section.clientHeight;
        if (scrollY >= (sectionTop - 100)) {
          current = section.getAttribute('id');
        }
      });

      navLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === `#${current}`) {
          link.classList.add('active');
        }
      });
    });

    // ========================================
    // THEME SWITCHING
    // ========================================
    
    // Set initial theme
    let currentTheme = 'light';
    
    function setTheme(theme) {
      currentTheme = theme;
      const root = document.documentElement;
      root.setAttribute('data-theme', theme);
      
      // Update toggle buttons
      document.getElementById('theme-light').classList.toggle('active', theme === 'light');
      document.getElementById('theme-dark').classList.toggle('active', theme === 'dark');
      
      // Save preference
      localStorage.setItem('theme', theme);
      
      // Update all charts with new theme
      updateChartsTheme(theme);
    }
    
    function getSystemTheme() {
      // Detect user's system preference
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }
    
    function updateChartsTheme(theme) {
      const colors = theme === 'dark' ? {
        background: '#171719',
        textPrimary: '#D9D9E0',
        textSecondary: '#999AA6',
        grid: '#4D4E56',
        tick: '#4D4E56'
      } : {
        background: '#f9fafb',
        textPrimary: '#1a1a1a',
        textSecondary: '#6b7280',
        grid: '#d1d5db',
        tick: '#d1d5db'
      };
      
      // Update Chart 1
      spec1.background = colors.background;
      spec1.axes[0].labelColor = colors.textSecondary;
      spec1.axes[0].tickColor = colors.tick;
      spec1.axes[1].labelColor = colors.textSecondary;
      spec1.axes[1].tickColor = colors.tick;
      spec1.axes[1].gridColor = colors.grid;
      vegaEmbed('#vis1', spec1, { actions: false, tooltip: { theme: theme === 'dark' ? 'dark' : 'light' } });
      
      // Update Chart 2
      spec2.background = colors.background;
      spec2.axes[0].labelColor = colors.textSecondary;
      spec2.axes[0].tickColor = colors.tick;
      spec2.axes[1].labelColor = colors.textSecondary;
      spec2.axes[1].tickColor = colors.tick;
      spec2.axes[1].gridColor = colors.grid;
      spec2.legends[0].labelColor = colors.textPrimary;
      vegaEmbed('#vis2', spec2, { actions: false, tooltip: { theme: theme === 'dark' ? 'dark' : 'light' } });
      
      // Update Chart 4
      spec4.background = colors.background;
      spec4.axes[0].labelColor = colors.textSecondary;
      spec4.axes[0].tickColor = colors.tick;
      spec4.axes[1].labelColor = colors.textSecondary;
      spec4.axes[1].tickColor = colors.tick;
      spec4.axes[1].gridColor = colors.grid;
      vegaEmbed('#vis4', spec4, { actions: false, tooltip: { theme: theme === 'dark' ? 'dark' : 'light' } });
      
      // Update Chart 6
      spec6.background = colors.background;
      spec6.axes[0].labelColor = colors.textSecondary;
      spec6.axes[0].tickColor = colors.textSecondary;
      spec6.axes[1].labelColor = colors.textPrimary;
      spec6.legends[0].labelColor = colors.textPrimary;
      vegaEmbed('#vis6', spec6, { actions: false, tooltip: { theme: theme === 'dark' ? 'dark' : 'light' } });
    }
    
    // Load theme on page load (prioritize saved preference, then system preference)
    window.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('theme');
      const systemTheme = getSystemTheme();
      
      // Use saved preference if exists, otherwise use system preference
      const initialTheme = savedTheme || systemTheme;
      setTheme(initialTheme);
    });
    
    // Listen for system theme changes
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
      // Only auto-switch if user hasn't explicitly set a preference
      if (!localStorage.getItem('theme')) {
        setTheme(e.matches ? 'dark' : 'light');
      }
    });

    // ========================================
    // SIMULATION FUNCTIONS
    // ========================================

    // Global simulation state
    let intervals = {};
    
    // Helper functions
    function updateStatus(chartId, message, isActive = false) {
      const status = document.getElementById(`status-${chartId}`);
      status.textContent = message;
      status.className = isActive ? 'sim-status active' : 'sim-status';
      if (isActive) {
        status.innerHTML = '<span class="pulse"></span>' + message;
      }
    }

    function showAlert(chartId, message) {
      const alert = document.getElementById(`alert-${chartId}`);
      alert.textContent = message;
      alert.className = 'alert-message show';
      setTimeout(() => alert.className = 'alert-message', 5000);
    }

    function toggleButtons(chartId, isRunning) {
      document.getElementById(`start-btn-${chartId}`).disabled = isRunning;
      document.getElementById(`pause-btn-${chartId}`).disabled = !isRunning;
    }

    // ========================================
    // CHART 1: Time-Series Line Chart
    // ========================================
    
    let chart1Data = [...spec1.data[0].values];
    const chart1Initial = JSON.parse(JSON.stringify(chart1Data));
    
    function startSimulation1() {
      toggleButtons(1, true);
      updateStatus(1, 'Streaming live metrics...', true);
      
      let iteration = 0;
      intervals.chart1 = setInterval(() => {
        iteration++;
        
        // Generate new data point with realistic variation
        const lastValue = chart1Data[chart1Data.length - 1].value;
        const newValue = Math.max(40, Math.min(100, lastValue + (Math.random() - 0.5) * 15));
        
        // Add new point
        chart1Data.push({
          time: `T+${iteration}`,
          value: newValue,
          series: "Production"
        });
        
        // Keep sliding window of 13 points
        if (chart1Data.length > 13) {
          chart1Data.shift();
        }
        
        // Update spec and re-render
        spec1.data[0].values = chart1Data;
        vegaEmbed('#vis1', spec1, { actions: false, tooltip: { theme: 'dark' } });
        
        // Check threshold
        if (newValue > 90) {
          showAlert(1, '‚ö†Ô∏è CPU usage exceeded 90% threshold!');
        }
      }, 1500);
    }

    function pauseSimulation1() {
      clearInterval(intervals.chart1);
      toggleButtons(1, false);
      updateStatus(1, 'Simulation paused');
    }

    function resetSimulation1() {
      clearInterval(intervals.chart1);
      chart1Data = JSON.parse(JSON.stringify(chart1Initial));
      spec1.data[0].values = chart1Data;
      vegaEmbed('#vis1', spec1, { actions: false, tooltip: { theme: 'dark' } });
      toggleButtons(1, false);
      updateStatus(1, 'Ready to simulate real-time metrics');
      document.getElementById('alert-1').className = 'alert-message';
    }

    // ========================================
    // CHART 2: Multi-Series Comparison
    // ========================================
    
    let chart2Data = [...spec2.data[0].values];
    const chart2Initial = JSON.parse(JSON.stringify(chart2Data));
    
    function startSimulation2() {
      toggleButtons(2, true);
      updateStatus(2, 'Simulating traffic spike...', true);
      
      let iteration = 0;
      intervals.chart2 = setInterval(() => {
        iteration++;
        
        // Simulate traffic spike - all environments increase, but Production fastest
        chart2Data = chart2Data.map(row => ({
          ...row,
          Production: Math.min(4000, row.Production + Math.random() * 150 + 100),
          Staging: Math.min(2500, row.Staging + Math.random() * 80 + 50),
          Development: Math.min(1200, row.Development + Math.random() * 40 + 20)
        }));
        
        spec2.data[0].values = chart2Data;
        vegaEmbed('#vis2', spec2, { actions: false, tooltip: { theme: 'dark' } });
        
        // Check if Production is significantly higher
        const lastRow = chart2Data[chart2Data.length - 1];
        if (lastRow.Production > 3000) {
          showAlert(2, 'üî• Production traffic spike detected: ' + Math.round(lastRow.Production) + ' req/sec');
        }
        
        // Stop after spike completes
        if (iteration >= 8) {
          pauseSimulation2();
          updateStatus(2, 'Traffic spike simulation complete');
        }
      }, 800);
    }

    function pauseSimulation2() {
      clearInterval(intervals.chart2);
      toggleButtons(2, false);
      updateStatus(2, 'Simulation paused');
    }

    function resetSimulation2() {
      clearInterval(intervals.chart2);
      chart2Data = JSON.parse(JSON.stringify(chart2Initial));
      spec2.data[0].values = chart2Data;
      vegaEmbed('#vis2', spec2, { actions: false, tooltip: { theme: 'dark' } });
      toggleButtons(2, false);
      updateStatus(2, 'Ready to simulate traffic patterns');
      document.getElementById('alert-2').className = 'alert-message';
    }

    // ========================================
    // CHART 4: Histogram Distribution
    // ========================================
    
    let chart4Data = [...spec4.data[0].values];
    const chart4Initial = JSON.parse(JSON.stringify(chart4Data));
    
    function startSimulation4() {
      toggleButtons(4, true);
      updateStatus(4, 'Simulating performance degradation...', true);
      
      let iteration = 0;
      intervals.chart4 = setInterval(() => {
        iteration++;
        
        // Shift distribution rightward (higher latency)
        chart4Data = chart4Data.map((bin, idx) => {
          // Decrease left bins, increase right bins
          let change = (idx - 2) * 150; // Middle bin stays same, left decrease, right increase
          return {
            ...bin,
            count: Math.max(100, bin.count + change + (Math.random() - 0.5) * 100)
          };
        });
        
        spec4.data[0].values = chart4Data;
        vegaEmbed('#vis4', spec4, { actions: false, tooltip: { theme: 'dark' } });
        
        // Calculate median (approximate)
        const rightHeavy = chart4Data[3].count + chart4Data[4].count;
        const total = chart4Data.reduce((sum, bin) => sum + bin.count, 0);
        if (rightHeavy / total > 0.4) {
          showAlert(4, '‚ö†Ô∏è Response time degradation detected: Median shifted to 150-200ms range');
        }
        
        // Stop after degradation is visible
        if (iteration >= 6) {
          pauseSimulation4();
          updateStatus(4, 'Degradation simulation complete');
        }
      }, 1000);
    }

    function pauseSimulation4() {
      clearInterval(intervals.chart4);
      toggleButtons(4, false);
      updateStatus(4, 'Simulation paused');
    }

    function resetSimulation4() {
      clearInterval(intervals.chart4);
      chart4Data = JSON.parse(JSON.stringify(chart4Initial));
      spec4.data[0].values = chart4Data;
      vegaEmbed('#vis4', spec4, { actions: false, tooltip: { theme: 'dark' } });
      toggleButtons(4, false);
      updateStatus(4, 'Ready to simulate performance degradation');
      document.getElementById('alert-4').className = 'alert-message';
    }

    // ========================================
    // CHART 6: Status Timeline
    // ========================================
    
    let chart6Data = [...spec6.data[0].values];
    const chart6Initial = JSON.parse(JSON.stringify(chart6Data));
    
    function startSimulation6() {
      toggleButtons(6, true);
      updateStatus(6, 'Simulating cascading incident...', true);
      
      let step = 0;
      intervals.chart6 = setInterval(() => {
        step++;
        
        if (step === 1) {
          // Database goes to error
          chart6Data = chart6Data.map(item => {
            if (item.service === 'Database' && item.start === 6) {
              return {...item, status: 'Error'};
            }
            return item;
          });
          showAlert(6, 'üî¥ Database service entered error state');
        }
        else if (step === 2) {
          // Auth service goes to warning
          chart6Data = chart6Data.map(item => {
            if (item.service === 'Auth Service' && item.start === 6) {
              return {...item, status: 'Warning'};
            }
            return item;
          });
          showAlert(6, 'üü° Auth Service degraded (cascading failure)');
        }
        else if (step === 4) {
          // Services start recovering
          chart6Data = chart6Data.map(item => {
            if (item.service === 'Database' && item.start === 6) {
              return {...item, status: 'Warning', end: 13};
            }
            if (item.service === 'Database' && item.start === 13) {
              return {...item, status: 'Healthy'};
            }
            return item;
          });
          showAlert(6, 'üü¢ Database recovering...');
        }
        else if (step === 5) {
          // Full recovery
          chart6Data = chart6Data.map(item => {
            if (item.service === 'Auth Service' && item.start === 6) {
              return {...item, status: 'Healthy'};
            }
            if (item.service === 'Database' && item.start === 6) {
              return {...item, status: 'Healthy'};
            }
            return item;
          });
          showAlert(6, '‚úÖ All services healthy - incident resolved');
          pauseSimulation6();
          updateStatus(6, 'Incident simulation complete');
        }
        
        spec6.data[0].values = chart6Data;
        vegaEmbed('#vis6', spec6, { actions: false, tooltip: { theme: 'dark' } });
      }, 2000);
    }

    function pauseSimulation6() {
      clearInterval(intervals.chart6);
      toggleButtons(6, false);
      updateStatus(6, 'Simulation paused');
    }

    function resetSimulation6() {
      clearInterval(intervals.chart6);
      chart6Data = JSON.parse(JSON.stringify(chart6Initial));
      spec6.data[0].values = chart6Data;
      vegaEmbed('#vis6', spec6, { actions: false, tooltip: { theme: 'dark' } });
      toggleButtons(6, false);
      updateStatus(6, 'Ready to simulate service incident');
      document.getElementById('alert-6').className = 'alert-message';
    }
  </script>
</body>
</html>
