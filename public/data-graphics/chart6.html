<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chart 06 ‚Äî Status Timeline (Health Bands)</title>
  <script src="/data-graphics/vega.min.js"></script>
  <script src="/data-graphics/vega-embed.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #0D0D0E; font-family: 'Inter', -apple-system, sans-serif; padding: 24px; }
    .header { margin-bottom: 16px; }
    .tag { display: inline-block; background: #22BF4A; color: white; font-size: 11px; font-weight: 600; padding: 3px 8px; border-radius: 3px; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
    .title { font-size: 18px; font-weight: 500; color: #D9D9E0; margin-bottom: 4px; }
    .desc { font-size: 13px; color: #999AA6; }
    .sim-bar { display: flex; align-items: center; gap: 10px; margin: 14px 0 10px; padding: 10px 14px; background: rgba(59,130,245,0.08); border: 1px solid rgba(59,130,245,0.25); border-radius: 6px; }
    .btn { border: none; padding: 6px 14px; border-radius: 4px; font-size: 13px; font-weight: 500; cursor: pointer; font-family: inherit; }
    .btn-start { background: #3B82F5; color: white; }
    .btn-pause { background: #F28500; color: white; }
    .btn-reset { background: #4b5563; color: white; }
    .btn:disabled { opacity: 0.4; cursor: not-allowed; }
    .status { color: #999AA6; font-size: 12px; display: flex; align-items: center; gap: 6px; }
    .status.live { color: #22BF4A; }
    .pulse { width: 7px; height: 7px; background: #22BF4A; border-radius: 50%; animation: pulse 2s infinite; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }
    .alert { margin-top: 10px; padding: 8px 12px; background: rgba(204,61,61,0.15); border: 1px solid rgba(204,61,61,0.4); border-radius: 4px; color: #CC3D3D; font-size: 12px; display: none; }
    .alert.show { display: block; }
    #vis { width: 100%; }
  </style>
</head>
<body>
  <div class="header">
    <span class="tag">Chart 06</span>
    <div class="title">Status Timeline (Health Bands)</div>
    <div class="desc">System health states over time. Service uptime, incident timelines, deployment status.</div>
  </div>
  <div class="sim-bar">
    <button class="btn btn-start" id="s1" onclick="start()">‚ñ∂ Simulate Incident</button>
    <button class="btn btn-pause" id="p1" onclick="pause()" disabled>‚è∏ Pause</button>
    <button class="btn btn-reset" id="r1" onclick="reset()">‚Ü∫ Reset</button>
    <div class="status" id="st1">Ready to simulate</div>
  </div>
  <div class="alert" id="al1"></div>
  <div id="vis"></div>

  <script>
    const initValues = [
      {"service":"Auth Service","start":0,"end":6,"status":"Healthy","serviceOrder":0},
      {"service":"Auth Service","start":6,"end":14,"status":"Warning","serviceOrder":0},
      {"service":"Auth Service","start":14,"end":24,"status":"Healthy","serviceOrder":0},
      {"service":"API Gateway","start":0,"end":10,"status":"Healthy","serviceOrder":1},
      {"service":"API Gateway","start":10,"end":24,"status":"Healthy","serviceOrder":1},
      {"service":"Database","start":0,"end":6,"status":"Healthy","serviceOrder":2},
      {"service":"Database","start":6,"end":10,"status":"Warning","serviceOrder":2},
      {"service":"Database","start":10,"end":13,"status":"Error","serviceOrder":2},
      {"service":"Database","start":13,"end":24,"status":"Healthy","serviceOrder":2}
    ];

    const spec = {
      "$schema": "https://vega.github.io/schema/vega/v5.json",
      "width": 860, "height": 220,
      "padding": {"top": 10, "left": 100, "right": 20, "bottom": 40},
      "background": "#171719",
      "data": [{"name":"table","values": JSON.parse(JSON.stringify(initValues))}],
      "scales": [
        {"name":"x","type":"linear","domain":[0,24],"range":"width","zero":true,"nice":false},
        {"name":"y","type":"band","domain":{"data":"table","field":"service","sort":{"field":"serviceOrder"}},"range":"height","padding":0.3},
        {"name":"color","type":"ordinal","domain":["Healthy","Warning","Error"],"range":["#22BF4A","#F28500","#CC3D3D"]}
      ],
      "axes": [
        {"orient":"top","scale":"x","labelColor":"#999AA6","labelFontSize":11,"labelFont":"Inter,sans-serif","labelPadding":8,"tickColor":"#999AA6","tickSize":5,"domain":false,"grid":false,"title":null,"format":"d","values":[0,6,12,18,24],"labelExpr":"datum.value + 'h'"},
        {"orient":"left","scale":"y","labelColor":"#D9D9E0","labelFontSize":12,"labelFont":"Inter,sans-serif","labelPadding":8,"tickSize":0,"domain":false,"grid":false,"title":null}
      ],
      "marks": [{"type":"rect","from":{"data":"table"},"encode":{
        "enter":{"x":{"scale":"x","field":"start"},"x2":{"scale":"x","field":"end"},"y":{"scale":"y","field":"service"},"height":{"scale":"y","band":1},"fill":{"scale":"color","field":"status"},"fillOpacity":{"value":0.85},"cornerRadius":{"value":3}},
        "update":{"fillOpacity":{"value":0.85},"stroke":{"value":null}},
        "hover":{"fillOpacity":{"value":1},"stroke":{"value":"#FFFFFF"},"strokeWidth":{"value":1}}
      }}],
      "legends": [{"fill":"color","title":null,"orient":"bottom","direction":"horizontal","symbolType":"square","symbolSize":100,"symbolOffset":8,"labelColor":"#D9D9E0","labelFont":"Inter,sans-serif","labelFontSize":11,"labelOffset":8,"offset":10}]
    };

    vegaEmbed('#vis', spec, {actions:false});
    let data = JSON.parse(JSON.stringify(initValues));
    let interval, step = 0;

    function start() {
      step = 0;
      document.getElementById('s1').disabled = true;
      document.getElementById('p1').disabled = false;
      setStatus('Simulating cascading incident...', true);
      interval = setInterval(() => {
        step++;
        if (step === 1) { mutate('Database', 6, 'Error'); showAlert('üî¥ Database entered error state'); }
        else if (step === 2) { mutate('Auth Service', 6, 'Error'); showAlert('üî¥ Auth Service degraded (cascading failure)'); }
        else if (step === 4) { mutate('Database', 6, 'Warning'); showAlert('üü° Database recovering...'); }
        else if (step === 5) {
          mutate('Database', 6, 'Healthy'); mutate('Auth Service', 6, 'Healthy');
          showAlert('‚úÖ All services healthy ‚Äî incident resolved');
          pause(); setStatus('Incident simulation complete');
        }
        spec.data[0].values = data;
        vegaEmbed('#vis', spec, {actions:false});
      }, 2000);
    }
    function mutate(service, start, status) {
      data = data.map(d => d.service === service && d.start === start ? {...d, status} : d);
    }
    function pause() {
      clearInterval(interval);
      document.getElementById('s1').disabled = false;
      document.getElementById('p1').disabled = true;
      setStatus('Paused');
    }
    function reset() {
      clearInterval(interval);
      data = JSON.parse(JSON.stringify(initValues));
      spec.data[0].values = data;
      vegaEmbed('#vis', spec, {actions:false});
      document.getElementById('s1').disabled = false;
      document.getElementById('p1').disabled = true;
      setStatus('Ready to simulate');
      document.getElementById('al1').className = 'alert';
    }
    function setStatus(msg, live=false) {
      const el = document.getElementById('st1');
      el.className = live ? 'status live' : 'status';
      el.innerHTML = live ? `<span class="pulse"></span>${msg}` : msg;
    }
    function showAlert(msg) {
      const el = document.getElementById('al1');
      el.textContent = msg; el.className = 'alert show';
      setTimeout(() => el.className = 'alert', 6000);
    }
  </script>
</body>
</html>
